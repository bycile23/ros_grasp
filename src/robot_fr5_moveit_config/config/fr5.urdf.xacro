<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="fr5">
  
  <xacro:include filename="$(find fr5)/urdf/camera.xacro" />
  <xacro:include filename="$(find fr5)/urdf/simple_gripper.xacro" />
  
  <xacro:property name="mesh_path" value="package://fr5/meshes/visual/" />

  <material name="white"><color rgba="1 1 1 1" /></material>
  <material name="light_blue"><color rgba="0.792 0.819 0.933 1" /></material>
  <material name="black"><color rgba="0.1 0.1 0.1 1"/></material>
  <material name="silver"><color rgba="0.8 0.8 0.8 1"/></material>

  <link name="world"/>
  <joint name="world_joint" type="fixed">
    <origin xyz="0 0 0" rpy="0 0 0" />
    <parent link="world"/>
    <child link="base_link"/>
  </joint>

  <link name="base_link">
    <inertial>
      <origin xyz="0 0 0.04" rpy="0 0 0" />
      <mass value="4.0" />
      <inertia ixx="0.1" ixy="0" ixz="0" iyy="0.1" iyz="0" izz="0.1" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry><mesh filename="${mesh_path}base_link.STL" /></geometry>
      <material name="white"/>
    </visual>
    <collision>
      <origin xyz="0 0 0.025" rpy="0 0 0" />
      <geometry><cylinder radius="0.06" length="0.05"/></geometry>
    </collision>
  </link>

  <link name="link1">
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <mass value="3.0" />
      <inertia ixx="0.05" ixy="0" ixz="0" iyy="0.05" iyz="0" izz="0.05" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry><mesh filename="${mesh_path}link1.STL" /></geometry>
      <material name="white"/>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry><cylinder radius="0.05" length="0.12"/></geometry>
    </collision>
  </link>
  <joint name="joint1" type="revolute">
    <origin xyz="0 0 0.152" rpy="0 0 0" />
    <parent link="base_link" /><child link="link1" />
    <axis xyz="0 0 1" />
    <limit lower="-3.14" upper="3.14" effort="1000" velocity="1.0" />
    <dynamics damping="10.0" friction="10.0"/>
  </joint>

  <link name="link2">
    <inertial>
      <origin xyz="0 0.2 0" rpy="0 0 0" />
      <mass value="8.0" /> <inertia ixx="0.2" ixy="0" ixz="0" iyy="0.2" iyz="0" izz="0.2" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry><mesh filename="${mesh_path}link2.STL" /></geometry>
      <material name="light_blue"/>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry><mesh filename="${mesh_path}link2.STL" /></geometry>
    </collision>
  </link>
  <joint name="joint2" type="revolute">
    <origin xyz="0 -0.138 0" rpy="1.5708 0 0" />
    <parent link="link1" /><child link="link2" />
    <axis xyz="0 0 1" />
    <limit lower="-3.14" upper="3.14" effort="1000" velocity="1.0" />
    <dynamics damping="20.0" friction="20.0"/>
  </joint>

  <link name="link3">
    <inertial>
      <origin xyz="0 0.2 0" rpy="0 0 0" />
      <mass value="4.0" /> <inertia ixx="0.1" ixy="0" ixz="0" iyy="0.1" iyz="0" izz="0.1" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry><mesh filename="${mesh_path}link3.STL" /></geometry>
      <material name="white"/>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry><mesh filename="${mesh_path}link3.STL" /></geometry>
    </collision>
  </link>
  <joint name="joint3" type="revolute">
    <origin xyz="0 0.425 -0.1378" rpy="-3.1416 0 0" />
    <parent link="link2" /><child link="link3" />
    <axis xyz="0 0 1" />
    <limit lower="-3.14" upper="3.14" effort="1000" velocity="1.0" />
    <dynamics damping="10.0" friction="10.0"/>
  </joint>

  <link name="link4">
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <mass value="1.5" /> <inertia ixx="0.05" ixy="0" ixz="0" iyy="0.05" iyz="0" izz="0.05" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry><mesh filename="${mesh_path}link4.STL" /></geometry>
      <material name="white"/>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry><mesh filename="${mesh_path}link4.STL" /></geometry>
    </collision>
  </link>
  <joint name="joint4" type="revolute">
    <origin xyz="0.39501 0.00025433 -0.1018" rpy="3.1416 0 0" />
    <parent link="link3" /><child link="link4" />
    <axis xyz="0 0 1" />
    <limit lower="-3.14" upper="3.14" effort="500" velocity="1.0" />
    <dynamics damping="5.0" friction="5.0"/>
  </joint>

  <link name="link5">
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <mass value="1.5" /> <inertia ixx="0.05" ixy="0" ixz="0" iyy="0.05" iyz="0" izz="0.05" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry><mesh filename="${mesh_path}link5.STL" /></geometry>
      <material name="white"/>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry><mesh filename="${mesh_path}link5.STL" /></geometry>
    </collision>
  </link>
  <joint name="joint5" type="revolute">
    <origin xyz="6.5538E-05 0.1018 0" rpy="1.5708 0 0" />
    <parent link="link4" /><child link="link5" />
    <axis xyz="-0.00064375 0 1" />
    <limit lower="-3.14" upper="3.14" effort="500" velocity="1.0" />
    <dynamics damping="5.0" friction="5.0"/>
  </joint>

  <link name="link6">
    <inertial>
      <origin xyz="0 0 -0.01" rpy="0 0 0" />
      <mass value="0.5" /> <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry><mesh filename="${mesh_path}link6.STL" /></geometry>
      <material name="white"/>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry><mesh filename="${mesh_path}link6.STL" /></geometry>
    </collision>
  </link>
  <joint name="joint6" type="revolute">
    <origin xyz="0.0998 0 6.4246E-05" rpy="-1.5708 0 -1.5708" />
    <parent link="link5" /><child link="link6" />
    <axis xyz="0 -0.00064375 1" />
    <limit lower="-3.14" upper="3.14" effort="500" velocity="1.0" />
    <dynamics damping="2.0" friction="1.0"/>
  </joint>

  <link name="tool0"/>
  <joint name="joint_tool0" type="fixed">
    <origin xyz="0 0 0" rpy="0 0 1.5708" />
    <parent link="link6" />
    <child link="tool0" />
  </joint>

  <xacro:macro name="fr5_ros2_control_joint" params="joint_name">
    <joint name="${joint_name}">
      <command_interface name="effort"/>
      <state_interface name="position">
        <param name="initial_value">0.0</param>
      </state_interface>
      <state_interface name="velocity"/>
    </joint>
  </xacro:macro>

  <ros2_control name="Fr5System" type="system">
    <hardware>
        <plugin>gazebo_ros2_control/GazeboSystem</plugin>
    </hardware>
    <xacro:fr5_ros2_control_joint joint_name="joint1"/>
    <xacro:fr5_ros2_control_joint joint_name="joint2"/>
    <xacro:fr5_ros2_control_joint joint_name="joint3"/>
    <xacro:fr5_ros2_control_joint joint_name="joint4"/>
    <xacro:fr5_ros2_control_joint joint_name="joint5"/>
    <xacro:fr5_ros2_control_joint joint_name="joint6"/>
    
    <joint name="left_finger_joint">
      <command_interface name="position"/> <state_interface name="position"><param name="initial_value">0.0</param></state_interface>
      <state_interface name="velocity"/>
    </joint>
    <joint name="right_finger_joint">
      <state_interface name="position"><param name="initial_value">0.0</param></state_interface>
      <state_interface name="velocity"/>
    </joint>
  </ros2_control>
  
  <gazebo>
    <plugin filename="libgazebo_ros2_control.so" name="gazebo_ros2_control">
      <robot_param>robot_description</robot_param>
      <robot_param_node>robot_state_publisher</robot_param_node>
      <parameters>$(find fr5)/config/fr5_controllers.yaml</parameters>
    </plugin>
    <plugin filename="libgazebo_ros_mimic_joint_plugin.so" name="mimic_joint_plugin">
      <joint>left_finger_joint</joint>
      <mimicJoint>right_finger_joint</mimicJoint>
      <multiplier>1.0</multiplier>
      <offset>0.0</offset>
      <sensitivity>0.0</sensitivity>
      <maxEffort>200.0</maxEffort>
      <pid>50.0 0.0 0.1</pid>
    </plugin>
  </gazebo>
  
  <xacro:setup_camera parent_link="base_link" xyz="0.6 -0.025 1.2" rpy="0 1.57 -1.57" />
  <xacro:simple_gripper prefix="" parent="tool0" />

</robot>